meta {
  name: Ingest Rich Email
  type: http
  seq: 5
}

post {
  url: {{baseUrl}}/api/v1/internal/email
  body: json
  auth: none
}

body:json {
  {
    "from": "notifications@mycompany.com",
    "from_name": "MyCompany Notifications",
    "to": ["john.doe@example.com", "jane.smith@example.com"],
    "cc": ["manager@example.com"],
    "bcc": ["archive@mycompany.com"],
    "reply_to": "support@mycompany.com",
    "subject": "ðŸŽ‰ Your Order #12345 Has Been Shipped!",
    "html": "<!DOCTYPE html><html><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>Order Shipped</title></head><body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;\"><table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff;\"><tr><td style=\"padding: 20px; text-align: center; background-color: #4A90E2;\"><img src=\"https://placehold.co/150x50/4A90E2/white?text=MyCompany\" alt=\"MyCompany Logo\" style=\"max-width: 150px;\"></td></tr><tr><td style=\"padding: 40px 30px;\"><h1 style=\"color: #333333; margin: 0 0 20px;\">Your Order Has Shipped! ðŸ“¦</h1><p style=\"color: #666666; line-height: 1.6;\">Hi <strong>John</strong>,</p><p style=\"color: #666666; line-height: 1.6;\">Great news! Your order <strong>#12345</strong> is on its way.</p><table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"10\" style=\"margin: 20px 0; border: 1px solid #dddddd;\"><tr style=\"background-color: #f9f9f9;\"><th style=\"text-align: left; border-bottom: 1px solid #dddddd;\">Item</th><th style=\"text-align: center; border-bottom: 1px solid #dddddd;\">Qty</th><th style=\"text-align: right; border-bottom: 1px solid #dddddd;\">Price</th></tr><tr><td style=\"border-bottom: 1px solid #eeeeee;\"><img src=\"https://picsum.photos/50/50\" alt=\"Product\" style=\"vertical-align: middle; margin-right: 10px; border-radius: 4px;\">Wireless Headphones</td><td style=\"text-align: center; border-bottom: 1px solid #eeeeee;\">1</td><td style=\"text-align: right; border-bottom: 1px solid #eeeeee;\">$79.99</td></tr><tr><td style=\"border-bottom: 1px solid #eeeeee;\"><img src=\"https://picsum.photos/50/50?random=2\" alt=\"Product\" style=\"vertical-align: middle; margin-right: 10px; border-radius: 4px;\">USB-C Cable (2m)</td><td style=\"text-align: center; border-bottom: 1px solid #eeeeee;\">2</td><td style=\"text-align: right; border-bottom: 1px solid #eeeeee;\">$19.98</td></tr><tr style=\"font-weight: bold;\"><td colspan=\"2\" style=\"text-align: right;\">Total:</td><td style=\"text-align: right;\">$99.97</td></tr></table><div style=\"text-align: center; margin: 30px 0;\"><a href=\"https://mycompany.com/track/12345\" style=\"display: inline-block; padding: 15px 30px; background-color: #4A90E2; color: #ffffff; text-decoration: none; border-radius: 5px; font-weight: bold;\">Track Your Order â†’</a></div><div style=\"background-color: #f9f9f9; padding: 20px; border-radius: 5px; margin: 20px 0;\"><h3 style=\"margin: 0 0 10px; color: #333333;\">Shipping Address</h3><p style=\"margin: 0; color: #666666;\">John Doe<br>123 Main Street<br>San Francisco, CA 94102<br>United States</p></div></td></tr><tr><td style=\"padding: 20px 30px; background-color: #333333; color: #ffffff; text-align: center;\"><p style=\"margin: 0 0 10px;\">Follow us on social media</p><a href=\"https://twitter.com/mycompany\" style=\"color: #ffffff; margin: 0 10px;\">Twitter</a> | <a href=\"https://facebook.com/mycompany\" style=\"color: #ffffff; margin: 0 10px;\">Facebook</a> | <a href=\"https://instagram.com/mycompany\" style=\"color: #ffffff; margin: 0 10px;\">Instagram</a><p style=\"margin: 15px 0 0; font-size: 12px; color: #999999;\">Â© 2026 MyCompany Inc. All rights reserved.<br><a href=\"https://mycompany.com/unsubscribe\" style=\"color: #999999;\">Unsubscribe</a> | <a href=\"https://mycompany.com/privacy\" style=\"color: #999999;\">Privacy Policy</a></p></td></tr></table></body></html>",
    "plain_text": "Your Order Has Shipped!\n\nHi John,\n\nGreat news! Your order #12345 is on its way.\n\nOrder Summary:\n- Wireless Headphones (1x) - $79.99\n- USB-C Cable 2m (2x) - $19.98\nTotal: $99.97\n\nTrack your order: https://mycompany.com/track/12345\n\nShipping Address:\nJohn Doe\n123 Main Street\nSan Francisco, CA 94102\nUnited States\n\n---\nMyCompany Inc.\nUnsubscribe: https://mycompany.com/unsubscribe",
    "headers": {
      "X-Priority": "1",
      "X-Campaign-ID": "order-shipped-2026",
      "List-Unsubscribe": "<https://mycompany.com/unsubscribe>"
    }
  }
}

tests {
  test("should return 201", function() {
    expect(res.status).to.equal(201);
  });

  test("should return non-empty message ID", function() {
    expect(res.body.id).to.be.a("string");
    expect(res.body.id.length).to.be.greaterThan(0);
    bru.setVar("richEmailId", res.body.id);
  });
}
